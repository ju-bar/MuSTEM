#  μSTEM <img src="https://github.com/ju-bar/MuSTEM/blob/master/Manual/Figures/350x350_inelastic_cbed.png" width="64" height="64" />

μSTEM is a transmission electron microscopy (TEM) simulation suite, in particular for scanning transmission electron microscopy (STEM) images, that was developed mainly at the University of Melbourne. The computing suite is based on the multislice
method. More detail can be found in the [manual](https://github.com/ju-bar/MuSTEM/blob/master/Manual/muSTEM_manual.pdf) and the following scientific paper:

[Modelling the inelastic scattering of fast electrons,
L.J. Allen, A.J. D'Alfonso and S.D. Findlay,
Ultramicroscopy, Vol. 151, pp. 11-22, (2015).](http://www.sciencedirect.com/science/article/pii/S0304399114002034)

<img src="https://github.com/ju-bar/MuSTEM/blob/master/Manual/Figures/512x512_out_PACBED.png" width="512" height="512" />

This is a fork of the [original µSTEM repository](https://github.com/HamishGBrown/MuSTEM).

## Precompiled executables

### [µSTEM v6.1 GPU single precision](https://github.com/ju-bar/MuSTEM/blob/master/Executables/CUDA_muSTEM_x64_v6.1_single_precision.zip)

#### Prerequisites
* 64-bit Windows OS
* A CUDA enabled GPU with compute class 3.0 up to 7.5, GPU compute classes >7.5 are only supported on Linux with the Nvidia HPC SDK.
* Version 10.1 of the [Nvidia CUDA toolkit](https://developer.nvidia.com/cuda-toolkit-archive), this installs the .dll files necessary to run the GPU versions of μSTEM.

### [µSTEM v6.1 CPU single precision](https://github.com/ju-bar/MuSTEM/blob/master/Executables/CPU_muSTEM_x64_v6.1_single_precision.zip)

#### Prerequisites
* 64-bit Windows OS
* The CPU version is linked against the Intel OpenMP libraries. It requires libiomp5md.dll, which is provided in the zip archive with the executable.

### Executables archive

Executables of previous versions can be found in the [Executables](https://github.com/ju-bar/MuSTEM/tree/master/Executables) folder of the repository.


## Version changes

### Version 6.1

* Enforced a limit of the energy-loss range for EELS simulation to start with 1 eV, to ensure interpolation and not run as extrapolation.
* Modified the plasmon menu to input "0" for no plasmon scattering to make that consistent with the other input menus.
* Added custom EELS to support simulations beyond the energy range of the default EELS tables. Custom EELS files can be generated by J. Barthel (ju.barthel@fz-juelich.de) on reasonable request.
* Added options display when calling muSTEM.exe options.
* Added option omp_num_threads={number} to allow OpenMP setup by users. By default the number of threads is set to half of the number of logical cores on the CPU. The maximum used threads is capped to number of (cores - 1).
* Modified GPU code summing over the diffraction plane. This now uses proper reduction and is faster than the previous implementation. The new implementation also resolves an instability that existed with the absorptive model code.
* Added a Linux makefile supporting GPU and CPU versions using the Nvidia HPC SDK and the Intel oneAPI.

### Version 6.0
* Added Monte-Carlo code to simulate plasmon scattering, see [B. Mendis, Ultramic. 206 (2019) 112816, doi:10.1016/j.ultramic.2019.112816].
* Updated the example run files distributed in the executable zip files. These also contain a STEM example now. Thanks to Duncan Alexander (EPFL, Lausanne, CH) for pointing out a problem with the distributed run files.


## Tutorial

Click [here](https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/ju-bar/MuSTEM/tree/master/Tutorial) to download the μSTEM tutorial calculations, powerpoint and activity sheet.

## Compiling source code

### Linux
A makefile is provided in the repository that can be used to compile the source code on Linux systems. The makefile supports both the CPU and GPU versions of μSTEM. To compile the code, run `make` in the terminal from the root directory of the repository. Adopt to your system / compiler installations. The distributed version assumes (CPU) the Intel oneAPI (ifx) and (GPU) the Nvidia HPC SDK (nvfortran).

### Windows
A compile_gpu.bat is provided with the repository to produce a GPU version of μSTEM. This script assumes that the PGI Fortran compiler is installed.
The repository also contains solution and project files for Microsoft Visual Studio 2022 set up to work with the Intel oneAPI for producing a CPU version of µSTEM.

Compiler and CUDA versions should be compatible and also support the hardware you are using.


## Contributing

Please contact [Dr. Hamish Brown](https://github.com/HamishGBrown) with project suggestions and contributions.


## Authors
* **Professor Les J Allen**
* [**Dr. Hamish G Brown**](https://github.com/HamishGBrown) - *Maintainer*
* **Dr. Adrian J D'Alfonso**
* **Dr. Scott D Findlay**
* **Dr. Ben D Forbes**
* [**Dr. Juri Barthel**](https://github.com/ju-bar) - *Fork Maintainer*


## License

This project is licensed under the GNU GPLv3.0 - see the [LICENSE.txt](LICENSE.txt) file for details.


## Acknowledgments

Les Allen, Adrian D'Alfonso and Scott Findlay originally took the initiative to make this code publicly available, with Adrian D'Alfonso taking on the considerable task of setting up the GPU code. Hamish Brown and Ben Forbes have subsequently made substantial refinements and extensions, with Ben Forbes responsible for several efficiency improvements. The code was developed mainly at the University of Melbourne. We would like to acknowledge the contributions of Mark Oxley and Chris Rossouw to the theoretical and numerical aspects of collaborative research that underpins μSTEM.

In particular, the code IONIZER, whose primary author has been Mark Oxley, was used to set up the parametrized atomic scattering factors for ionization used in μSTEM. Eireann Cosgriff, Torgny Josefsson, Nathan Lugg, Andrew Martin, Gary Ruben and Chris Witte have been members of the group at Melbourne University at various stages and all made contributions to our understanding of inelastic scattering and the simulation thereof. 

